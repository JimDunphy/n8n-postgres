# Protocols
ssl_protocols TLSv1.2 TLSv1.3;

# Prefer modern ECDH curves; X25519 is fast on mobile, secp256r1 is widely compatible
ssl_ecdh_curve X25519:secp256r1:secp384r1;

# TLS 1.2 ciphers (short, modern set). TLS 1.3 ciphers use OpenSSL defaults.
# Includes CHACHA20-POLY1305 for mobile/CPU-without-AES acceleration.
ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305';

# Server chooses (applies to TLS≤1.2; TLS 1.3 has its own preference rules)
ssl_prefer_server_ciphers on;

# Sessions (good for performance)
ssl_session_cache   shared:SSL:50m;   # ~200k sessions; tune 10m–50m
ssl_session_timeout 1d;
ssl_session_tickets off;              # on only if you manage ticket keys cluster-wide

# Security headers (set once here to reuse in all vhosts)
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
add_header X-Frame-Options DENY;
add_header X-Content-Type-Options nosniff;

# (Optional) If you terminate TLS and then proxy to HTTPS backends, you can pin proxy TLS:
# proxy_ssl_protocols TLSv1.2 TLSv1.3;
# proxy_ssl_server_name on;

